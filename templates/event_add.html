<!DOCTYPE html>
<title>{{@appname}} :: Add an event</title>

<F3:include href="_stylesheets.html" />
<link rel="stylesheet" type="text/css" href="{{@baseurl}}/css/editform.css">
<link rel="stylesheet" type="text/css" href="{{@baseurl}}/css/jquery.timepicker.css">
<link rel="stylesheet" type="text/css" href="{{@baseurl}}/css/jquery-ui-1.8.24.custom.css">

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script src="{{@baseurl}}/js/jquery-ui-1.8.24.custom.min.js"></script>
<script src="{{@baseurl}}/js/jquery.timepicker.min.js"></script>
<script src="{{@baseurl}}/js/venuelist.js"></script>

<script>
$(function() {

// Datepicker
$("#date").hide();
$("#datepicker").datepicker({
	dateFormat: "yy-mm-dd",
	firstDay: 1,
	onSelect: function(dt, inst) { $("#date").val(dt); },
	minDate: 1,
	maxDate: "+2M",
	defaultDate: $("#date").val()
});

// Timepicker
$("#time").timepicker({ step: 15, timeFormat: 'H:i' });

// Film/free functionality
$("#film").click(function(e) {
	if (e.target.checked)
		$("#title").addClass("film");
	else
		$("#title").removeClass("film");
});

var update_disabled = function() {
	if ($("#free").attr('checked') == "checked")
		$("#cost").attr('disabled', 'disabled');
	else
		$("#cost").removeAttr('disabled');
};

update_disabled();
$("#free").change(update_disabled);
$("#costbutton").change(update_disabled);

// Set up an initial value
if ($('input[name="free"]:checked').length == 0) {
	$("#free").attr('checked', 'checked');
}

// Venuelist
var mylist = [
<F3:repeat group="{{@get_venues()}}" value="{{@venue}}">
	"{{@venue.name}}",
</F3:repeat>
];

venuelist.init(mylist, "#vlist", "#location");
venuelist.empty = function(empty) {
	if (empty)
		$("#venues").addClass("empty");
	else
		$("#venues").removeClass("empty");	
};

$("#venues").show();

});
</script>

<body class="thin">
<F3:include href="_header.html" />

<section id="add">
<h2>Add an event</h2>

<F3:check if="{{count(@messages)}}">
<ul>
<F3:repeat group="{{@messages}}" value="{{@message}}">
	<li>{{@message}}
</F3:repeat>
</ul>
</F3:check>

<form method="POST" action="?">

<fieldset>
<label class="left" for="title">Event name:</label>
<input class="right" type="text" name="title" id="title" {{@value(@title)}}>

<div class="right">
<input type="checkbox" id="film" name="film" {{@film?'checked':''}}>
<label for="film">This is a film showing</label>
</div>
</fieldset>

<fieldset>
<label class="left" for="location">Location:</label>
<input class="right" type="text" name="location" id="location" autocomplete="off" {{@value(@location)}}>
</fieldset>

<div id="venues" style="display: none;">Or select from below:
<ul id="vlist"></ul>
</div>
</fieldset>

<fieldset>
<label class="left" for="date">Time and date:</label>
<input class="right" type="text" name="time" id="time" {{@value(@time)}} placeholder="Time (hh:mm)"><br>
<input class="right" type="text" name="date" id="date" {{@value(@date)}} placeholder="Date (yyyy-mm-dd)">
<div class="right" id="datepicker"></div>
</fieldset>

<fieldset>
<label class="left">Price:</label>

<div class="right">
<input type="radio" name="free" id="free" {{@free?'checked':''}} value="free"> <label for="free">Free</label><br>
<input type="radio" name="free" id="costbutton" {{@cost?'checked':''}}> <label for="costbutton">It costs</label> <input type="text" name="cost" id="cost" style="width: 220px;" {{@value(@cost)}}>
</div>
</fieldset>

<fieldset>
<div class="left">
<label for="blurb">Please describe your event:</label>
<p class="desc">Please include the group organising the event and information about booking if you have to book.</p>
</div>

<textarea class="right" name="blurb" id="blurb" rows="8">{{@blurb}}</textarea>
</fieldset>

<fieldset>
<div class="left">
<label for="url">URL for more info:</label>
<p class="desc">Is there somewhere on the web people can go to get more information, like a blog post / Facebook event?</p>
</div>

<input class="right" type="text" name="url" id="url" {{@value(@url)}}>
</fieldset>

<fieldset>
<label class="left" for="email">Your email:</label>
<input class="right" type="text" name="email" id="email" {{@value(@email)}}>
</fieldset>

<input type="submit" value="Submit your event!">
</form>
</section>

<F3:include href="_footer.html" />
